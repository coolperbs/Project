!function(){var a,b,c,d,e,f,g;g={LOC_HREF:window.location.href,DM_COLLECT_URL:"lg.dmall.com/opDataPush/opDataPushWeb",TRACE_EVENT_DATA:"data-traceevent",BACK_CLS:"J_ToolBarBack",LINK_CLS:"J_Link",CLICK_TRACE_CLS:"J_ClickTrace",TIMEOUT:2e4},e={init:function(){f.initBeianTrack(),f.initBaidu(),f.bind()},trackDmall:function(a){return},trackPage:function(){f.trackPageBaidu(),f.trackPageDmall()},trackRegister:function(a){f.trackRegister(a)},trackOrderClick:function(a){f.trackOrderClick(a)},trackPageDmall:function(){f.trackPageDmall()},trackClick:function(a,b){f.trackClickBaidu(a,b)},trackClickAct:function(a,b){_hmt.push(["_trackEvent",a,a+" "+b])}},f={bind:function(){var a=$(document.body);a.on("click",function(a){var b=$(a.target),c=b.hasClass(g.CLICK_TRACE_CLS)?b:b.parents("."+g.CLICK_TRACE_CLS);switch(e.trackClick(c),!0){case b.hasClass(g.BACK_CLS)||b.parents("."+g.BACK_CLS).length>0:e.trackClick(null,"点击返回")}})},initBaidu:function(){var a=document.createElement("script");a.src="//hm.baidu.com/hm.js?3c760cfd485a098a377d76ceec857d7d";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)},trackPageBaidu:function(){var a=g.LOC_HREF;a=a.split("dmall.com"),a.shift(),a=a.join("/"),a=a.replace("#","?"),_hmt.push(["_trackPageview",a])},trackPageDmall:function(){var a,c=(g.LOC_HREF,b.currentPath),d=b.requestParam||{},e=d.id||"";window.DmallAnalysis&&(a=f.getDmallParam(),a.refer_url=b.prevUrl||document.referrer||"",c&&"wxdmall/view/minisite/minisite"==c&&(e=e.split("-"),a.venderid=e[1],a.storeid=e[2]),c&&"item/view/item/item"==c&&(e=e.split("-"),a.venderid=e[0],a.storeid=e[1]),window.DmallAnalysis.digger.setOverrideParams(a),window.DmallAnalysis.digger.sendPageViewTracker())},trackOrderClick:function(a){var b,e,g=d+"collect.dmall.com/mweb/order_click",h=c.get("cookie_id")||"";if(window.DmallAnalysis){b=f.getDmallParam()||{},e=$.extend(b,a||{});var i={client_flag:"WeChat",cookie_id:h,user_id:e.user_id,pvid:"",channel_id:e.channel_id,venderid:e.venderid,storeid:e.storeid,order_id:e.order_id||"",status_code:e.status_code||""};f.insertImgToPage(g,i)}},trackRegister:function(a){var e,h,i=g.LOC_HREF,j=d+"collect.dmall.com/mweb/m_register",k=c.get("cookie_id")||"";if(window.DmallAnalysis){e=f.getDmallParam()||{},h=$.extend(e,a||{});var l={client_flag:"WeChat",cookie_id:k,user_id:h.user_id,pvid:"",channel_id:h.channel_id,venderid:h.venderid,storeid:h.storeid,url:i,refer_url:b.prevUrl||document.referrer||"",latitude:h.latitude,longitude:h.longitude,ext:"",phone:a.phone||"",flag:h.flag};f.insertImgToPage(j,l)}},insertImgToPage:function(a,b){var c,b=b||{};a=a+"?"+f.parseParam(b),c=new Image,c.src=a},parseParam:function(a){var b,c=[],d=a||{};for(b in d)"url"==b||"refer_url"==b?c.push(b+"="+encodeURIComponent(d[b])):c.push(b+"="+d[b]);return c.join("&")},trackClickBaidu:function(a,c){a=$(a);var d=a.attr(g.TRACE_EVENT_DATA),e=b.currentPath||"";if(d=d||c){d=e+" "+d;var f=b.requestParam,h=f.source_id||"",i=d+" "+h;_hmt.push(["_trackEvent",e,d,i])}},initBeianTrack:function(){window._digger_={disablePageViewTrack:!0,trackerUrlMap:{pageView:["//collect.dmall.com/mweb/m_pv"]},cookieDomain:".dmall.com",strictMode:{paramOrder:{"//collect.dmall.com/mweb/m_pv":["client_flag","cookie_id","user_id","pvid","channel_id","venderid","storeid","url","refer_url","latitude","longitude","ext"]},disableDefaultParams:!0},extendParams:{client_flag:"WeChat",ext:"",pvid:"",channel_id:""},trackCookieKeys:{storeid:"store_id",user_id:"ticketLoginId",venderid:"vender_id"},trackLocalStorageKeys:{latitude:"location.latitude",longitude:"location.longitude"}};var a=d+"static.dmall.com/lib/wx-dmall/bigdata/",b=document,c=b.createElement("script"),e=b.getElementsByTagName("script")[0];c.type="text/javascript",c.async=!0,c.defer=!0,c.src=a+"digger.js",e.parentNode.insertBefore(c,e)},getDmallParam:function(){var a,b,d,e,f={},g=c.get("wxLoc")||"",h=c.get("wxShops"),i=[],j=[];for(h=h.split(","),g=g.split(","),a=g[0]||"",b=g[1]||"",d=0;e=h[d];++d)e=e.split("-"),i.push(e[0]||""),j.push(e[2]||"");return f={user_id:c.get("ticketLoginId")||"",venderid:i.join(","),storeid:j.join(","),latitude:b,longitude:a}}},define("kayak/common/track/track",function(require,f,g){a=require("kayak/core/kayak"),c=require("kayak/common/cookie/cookie"),b=a.router,d=a.EVT,g.exports=e})}();