!function(){var a,b,c,d,c,e,f,g=$.Callbacks();e={init:function(){f.initDigger(),f.injectDiggerJs()},trackPage:function(){return g.fired()?void f.trackPage():void g.add(f.trackPage)},trackClick:function(a){var b,d,e,g,h=[];b=f.getDmallParam()||{},e=$.extend(b,a||{}),g={client_flag:"WeChat",cookie_id:c.get("cookie_id")||"",user_id:e.user_id,pvid:"",channel_id:e.channel_id||"",venderid:e.venderid,storeid:e.storeid,event_flag:e.event_flag||""};for(d in g)h.push(d+"="+g[d]);f.createImg("http://collect.dmall.com/mweb/m_event_click",h.join("&"))},trackOrderClick:function(a){var b,d,e,g,h=[];if(window.DmallAnalysis){b=f.getDmallParam()||{},e=$.extend(b,a||{}),g={client_flag:"WeChat",cookie_id:c.get("cookie_id")||"",user_id:e.user_id,pvid:"",channel_id:e.channel_id||"",venderid:e.venderid,storeid:e.storeid,order_id:e.order_id||"",status_code:e.status_code||""};for(d in g)h.push(d+"="+g[d]);f.createImg("http://collect.dmall.com/mweb/order_click",h.join("&"))}},trackRegister:function(a){var d,e,g,h,i=[];if(window.DmallAnalysis){d=f.getDmallParam()||{},g=$.extend(d,a||{}),h={client_flag:"WeChat",cookie_id:c.get("cookie_id")||"",user_id:g.user_id,pvid:"",channel_id:g.channel_id||"",venderid:g.venderid,storeid:g.storeid,url:encodeURIComponent(window.location.href),refer_url:encodeURIComponent(b.prevUrl||document.referrer||""),latitude:g.latitude,longitude:g.longitude,ext:"",phone:a.phone||"",flag:g.flag};for(e in h)i.push(e+"="+h[e]);f.createImg("http://collect.dmall.com/mweb/m_register",i.join("&"))}},trackAddShoppingCart:function(a){var b,d=window.location.href;b="http://collect.dmall.com/mweb/add_cart_click?client_flag=WeChat&cookie_id="+(c.get("cookie_id")||"")+"&user_id="+(c.get("ticketLoginId")||"")+"&pvid=&channel_id=&venderid="+a.venderid+"&storeid="+a.storeid+"&ware_id=&sku_id="+a.sku_id+"&page_type=6&page_name="+encodeURIComponent(d),f.createImg(b,"")}},f={getClientFlag:function(){var a=utils.getClientType(),b="";return b="app"==a.clientName?a.clientNameArr.indexOf("android")>-1?"android":"iphone":a.clientNameArr.indexOf("browser")>-1?"mweb":"wechat"},initDigger:function(){window._digger_={disablePageViewTrack:!0,disableAutoReport:!0,trackerUrlMap:{pageView:["http://collect.dmall.com/mweb/m_pv"]},cookieDomain:".dmall.com",strictMode:{paramOrder:{"http://collect.dmall.com/mweb/m_pv":["client_flag","cookie_id","user_id","pvid","channel_id","venderid","storeid","url","refer_url","latitude","longitude","ext"]},disableDefaultParams:!0},extendParams:{client_flag:"WeChat",ext:"",pvid:"",channel_id:""},trackCookieKeys:{storeid:"store_id",user_id:"ticketLoginId",venderid:"vender_id"},trackLocalStorageKeys:{latitude:"location.latitude",longitude:"location.longitude"}}},injectDiggerJs:function(a){var b="//static.dmall.com/lib/wx-dmall/bigdata/digger.js";$.getScript(b,function(){g.fire()})},trackPage:function(){var a,c=b.currentPath,d=b.requestParam||{},e=d.id||"";window.DmallAnalysis&&(a=f.getDmallParam(),a.refer_url=encodeURIComponent(b.prevUrl||document.referrer||""),c&&"wxdmall/view/minisite/minisite"==c&&(e=e.split("-"),a.venderid=e[1],a.storeid=e[2]),c&&"item/view/item/item"==c&&(e=e.split("-"),a.venderid=e[0],a.storeid=e[1]),window.DmallAnalysis.digger.setOverrideParams(a),window.DmallAnalysis.digger.sendPageViewTracker())},getDmallParam:function(){var a,b,d={},e=c.get("wxLoc")||"",f=c.get("wxShops"),g=[],h=[];for(f=f.split(","),e=e.split(","),a=0;b=f[a];++a)b=b.split("-"),g.push(b[0]||""),h.push(b[2]||"");return d={user_id:c.get("ticketLoginId")||"",venderid:g.join(","),storeid:h.join(","),latitude:e[1]||"",longitude:e[0]||""}},createImg:function(a,b,c){var d=new Image(1,1);d.onload=function(){iterator=0,"function"==typeof c&&c()},d.src=a+(a.indexOf("?")<0?"?":"")+b}},define("kayak/common/track/bigdata",function(require,f,g){a=require("kayak/core/kayak"),c=require("kayak/common/cookie/cookie"),b=a.router,d="http://",g.exports=e})}();