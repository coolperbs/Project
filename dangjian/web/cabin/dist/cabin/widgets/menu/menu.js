!function(){function a(a,c){this.menu=[],this.id=a,b.init.call(this,c)}var b,c,d={menu:[{name:"默认菜单",router:"默认菜单路由",icon:""}]};a.prototype={updateDomState:function(a){var b=Number(a.attr("isparent")),c=a;b?c.toggleClass("open"):this.setHash(a.attr("href"))},setHash:function(a){window.location.hash=a},getHash:function(){return c.router},setMenuState:function(){var a=this,d=$("#"+this.id).find(".menu-ul").eq(0),e="";e=c.router.requestParam.iframeUrl?c.router.currentPath+":iframeUrl="+c.router.requestParam.iframeUrl:c.router.currentPath;var f=JSON.stringify(this.menu);f.indexOf(e)<0||setTimeout(function(){b.setState.call(a,d,e)},100)}},b={init:function(a){this.id&&(this.menu=a.menu?a.menu:d.menu,b.render.call(this))},render:function(){var a="",c=this;a=b.getHtml.call(this,this.menu,1),a='<div class="cabin-widgets-menu">'+a+"</div>",$("#"+this.id).html(a),b.bind.apply(this),c.setMenuState(),$(window).unbind("hashchange"),$(window).on("hashchange",function(){c.setMenuState()})},getHtml:function(a,c){for(var d="",e=0;e<a.length;e++){var f=a[e],g="";!!f.children&&f.children.length?(g=c>1?"menu-icon-arrow":f.icon,d+='<li class="menu-item parent" isparent="1"  data-level='+c+'><div class="menu-title menu-'+c+'" data-level='+c+'><i class="menu-icon '+g+'"></i><span class="menu-href">'+f.name+"</span></div>"+b.getHtml(f.children,c+1)+"</li>"):(g=1===c?f.icon:"",d+='<li class="menu-item" isparent="0" href="'+f.router+'"><div class="menu-title menu-'+c+'" data-level='+c+'><i class="menu-icon '+g+'"></i><span class="menu-href">'+f.name+"</span></div></li>")}return d='<ul class="menu-ul">'+d+"</ul>"},bind:function(){var a=this;$("#"+this.id).find(".menu-item").on("click",function(b){b.stopPropagation();var c=$(b.delegateTarget);a.updateDomState(c)})},setState:function(a,c,d){for(var e=$(a.children()),f=0;f<e.length;f++){var g=e[f],h=$(g),i=Number(h.attr("isparent")),j=h.children().eq(1);if(i)b.setState(j,c,function(){for(var a=!1,b=$(j.children()),c=0;c<b.length;c++){var d=b[c];if(a=$(d).hasClass("active")||$(d).hasClass("open"))break}a?h.addClass("open active"):h.removeClass("open active")});else{var k=h.attr("href");k=="#"+c?h.addClass("active"):h.removeClass("active")}f==e.length-1&&d&&d()}}},$.fn.CabinMenu=function(b){var c=this.prop("id");return new a(c,b)},define("cabin/widgets/menu/menu",function(require,b,d){c=require("kayak/core/kayak"),require("cabin/widgets/menu/menu.css"),d.exports=function(b,c){return new a(b,c)}})}();