!function(){function a(a,c,d){this.id=null,this.setting=null,this.treeNode=null,this.zTree=null,b.init.call(this,a,c,d)}var b,c,d={view:{dblClickExpand:!1,showLine:!1,showIcon:!1,addDiyDom:function(a,c){b.addDiyDom(a,c)}},search:!0,check:{enable:!0,checkAll:!0},data:{simpleData:{enable:!0}},callback:{onClick:function(a,c,d,e){b.singleClick(a,c,d),e&&e(a,c,d)},onCheck:function(a,c,d,e){b.allCheck(a,c,d),e&&e(a,c,d)}}};a.prototype={getFistClassChecked:function(){var a=this.zTree.getCheckedNodes(),b=[];return $.each(a,function(a,c){null===c.pId&&b.push({id:c.id,pId:c.pId,name:c.name})}),b}},b={init:function(a,c,e){if(""!=a&&(null!=a||void 0!=a)){this.id=a,this.treeNode=e;var f=JSON.parse(JSON.stringify(c));f.view=f.view?f.view:d.view,f.check=f.check?f.check:d.check,f.data=f.data?f.data:d.data,f.callback=f.callback?f.callback:{},f.check.checkAll=!!f.check.enable&&!(!f.check.checkAll&&"boolean"==typeof f.check.checkAll),f.view.addDiyDom=function(a,d){b.addDiyDom(a,d);var e=c.view&&c.view.addDiyDom?c.view.addDiyDom:null;e&&e(a,d)},f.callback.onClick=function(a,d,e){b.singleClick(a,d,e);var f=c.callback&&c.callback.onClick?c.callback.onClick:null;f&&f(a,d,e)},f.callback.onCheck=function(a,d,e){b.allCheck(a,d,e);var f=c.callback&&c.callback.onCheck?c.callback.onCheck:null;f&&f(a,d,e)},f.search=d.search;var g=$("#"+this.id);if(f.check.checkAll&&e.push({checked:!1,id:new Date,name:"全选",parent:!1,type:"allcheck"}),this.zTree=$.fn.zTree.init(g,f,e),f.search){var h='<input type="text" class="ztree-search form-control" placeholder="搜索">';g.prepend($(h)),b.bind.apply(this)}}},addDiyDom:function(a,b){var c=20,d=$("#"+b.tId+"_check"),e=$("#"+b.tId+"_switch"),f=$("#"+b.tId+"_ico");if(d.remove(),e.remove(),f.before(e),f.before(d),b.level>0){var g="<span style='display: inline-block;width:"+c*b.level+"px'></span>";e.before(g)}},singleClick:function(a,b,c){var d=$.fn.zTree.getZTreeObj(b);d.expandNode(c)},allCheck:function(a,b,c){var d=$.fn.zTree.getZTreeObj(b);if("allcheck"==c.type)c.checked?d.checkAllNodes(!0):d.checkAllNodes(!1);else if(c.checked){if(d.getCheckedNodes().length==c.length-1){var e=d.getNodeByParam("type","allcheck",null);if(!e)return;d.checkNode(d.getNodeByParam("type","allcheck",null),!0,!0)}}else{var e=d.getNodeByParam("type","allcheck",null);if(!e)return;d.checkNode(e,!1,!0)}},search:function(a){var b=$(a.target).val(),d=$.fn.zTree.getZTreeObj(this.id),e=[];if(b)return e=d.getNodesByParamFuzzy("name",b,null),!e||e.length<1?void c.show("暂无数据！"):void d.selectNode(e[0])},bind:function(){var a=this;$("#"+this.id).find(".ztree-search").on("keyup",function(c){b.search.call(a,c)})}},$.fn.CabinZtree=function(b,c){var d=this.prop("id");return new a(d,b,c)},define("cabin/widgets/ztree/ztree",function(require,b,d){require("cabin/lib/ztree/jquery.ztree.all.js"),c=require("medusa/widgets/tips/tips"),d.exports=function(b,c,d){return new a(b,c,d)}})}();