!function(){function a(a,b){this.opt=null,this.id=a,this.spin={head:1,end:9},this.init(b)}var b,c,d={pageSize:30,currentPage:1,totalCount:0,callback:null,container:null,pageRange:9,select:[30,60,100],showTotal:!1,position:null};a.prototype={init:function(a){if(this.id&&"function"==typeof a.callback){var e=$("#"+this.id),f=$(b).clone();this.opt={pageSize:a.pageSize?a.pageSize:d.pageSize,currentPage:a.currentPage?a.currentPage:d.currentPage,totalCount:a.totalCount?a.totalCount:d.totalCount,callback:a.callback?a.callback:d.callback,select:a.select?a.select:d.select,pageRange:a.pageRange?a.pageRange:d.pageRange,position:a.position?a.position:d.position,showTotal:a.showTotal?a.showTotal:d.showTotal},e.html(""),this.opt.position&&f.addClass(this.opt.position),e.append(f),c.formatOptions.apply(this),c.updateSpin.apply(this),c.render.apply(this),c.bind.apply(this)}},update:function(a){for(k in a)this.opt[k]=a[k];c.formatOptions.apply(this),c.updateSpin.apply(this),c.render.apply(this)},next:function(a){if(!$(a.target).hasClass("disabled")){var b=Math.ceil(this.opt.totalCount/this.opt.pageSize);this.opt.currentPage+1>b?this.opt.currentPage=b:this.opt.currentPage+=1,c.updateSpin.apply(this),c.render.apply(this,[!0])}},prev:function(a){$(a.target).hasClass("disabled")||(this.opt.currentPage-1<1?this.opt.currentPage=1:this.opt.currentPage-=1,c.updateSpin.apply(this),c.render.apply(this,[!0]))}},c={bind:function(){var a=$("#"+this.id),b=a.find(".nextpage-pagelist"),d=a.find(".nextpage-input"),e=a.find(".prev"),f=a.find(".next"),g=a.find(".nextpage-select-input"),h=a.find(".nextpage-select-chosen"),i=this;b.on("click",function(a){a.stopPropagation(),c.checkPage.apply(i,[a])}),e.on("click",function(a){a.stopPropagation(),i.prev(a)}),f.on("click",function(a){a.stopPropagation(),i.next(a)}),d.on("click",function(a){a.stopPropagation()}),d.on("keyup",function(a){c.setCurrentPage.apply(i,[a])}),g.on("click",function(a){a.stopPropagation(),c.showSelect.apply(i,[a])}),h.on("click",function(a){a.stopPropagation(),c.chosenCheck.apply(i,[a])}),$("body").on("click",function(a){a.stopPropagation(),c.hideSelect.apply(i,[a])})},render:function(a){var b=$("#"+this.id),c=b.find(".nextpage-pagelist"),d=b.find(".nextpage-select-input"),e=b.find(".nextpage-input"),f=b.find(".prev"),g=b.find(".next"),h=b.find(".nextpage-select-chosen"),i=b.find(".total"),j=Math.ceil(this.opt.totalCount/this.opt.pageSize),k="",l="",m=1;if(j>10){for(m=this.spin.head;m<this.spin.end+1;m++)k+=this.opt.currentPage===m?'<li class="active" data-page="'+m+'">'+m+"</li>":'<li data-page="'+m+'">'+m+"</li>";this.opt.currentPage<this.opt.pageRange?(k+="<li>...</li>",k+='<li data-page="'+j+'">'+j+"</li>",c.html(""),c.html(k)):this.spin.end<j?(k='<li data-page="1">1</li></li><li data-page="'+m+'">...</li>'+k,k+="<li>...</li>",k+='<li data-page="'+j+'">'+j+"</li>",c.html(""),c.html(k)):(k='<li data-page="1">1</li></li><li>...</li>'+k,c.html(""),c.html(k))}else{for(m=1;m<=j;m++)k+=this.opt.currentPage===m?'<li class="active" data-page="'+m+'">'+m+"</li>":'<li data-page="'+m+'">'+m+"</li>";c.html(""),c.html(k)}for(m=0;m<this.opt.select.length;m++)l+=this.opt.pageSize===this.opt.select[m]?'<li class="active" data-size="'+this.opt.select[m]+'">'+this.opt.select[m]+"</li>":'<li data-size="'+this.opt.select[m]+'">'+this.opt.select[m]+"</li>";e.val(this.opt.currentPage),d.html(this.opt.pageSize),h.html(l),this.opt.showTotal&&i.html("共"+this.opt.totalCount+"条"),f.removeClass("disabled"),g.removeClass("disabled"),1===this.opt.currentPage&&f.addClass("disabled"),this.opt.currentPage===j&&g.addClass("disabled"),a&&this.opt.callback(JSON.parse(JSON.stringify(this.opt)))},checkPage:function(a){var b=$(a.target),d=b.attr("data-page");d&&(d=Number(d),isNaN(d)&&(d=1),this.opt.currentPage!==d&&(this.opt.currentPage=d,c.updateSpin.apply(this),c.render.apply(this,[!0])))},updateSpin:function(){var a=Math.ceil(this.opt.totalCount/this.opt.pageSize);this.opt.currentPage>this.opt.pageRange-1?(this.spin.head=this.opt.currentPage-4,this.spin.end=this.opt.currentPage+4,this.spin.end>a&&(this.spin.end=a,this.spin.head=this.spin.end-8)):(this.spin.head=1,this.spin.end=9)},setCurrentPage:function(a){var b=Math.ceil(this.opt.totalCount/this.opt.pageSize),d=$(a.target),e=d.val();e&&(e=Number(e),isNaN(e)&&(e=1),13===a.keyCode&&(e>b&&(e=b),this.opt.currentPage=e,c.updateSpin.apply(this),c.render.apply(this,[!0])))},showSelect:function(a){var b=$("#"+this.id),c=b.find(".nextpage-select-input"),d=b.find(".nextpage-select-chosen"),e=c.offset().top,f=$(document).height(),g=f-e;d.removeClass("top bottom"),g>150?d.addClass("bottom active"):d.addClass("top active")},hideSelect:function(a){var b=$("#"+this.id),c=b.find(".nextpage-select-chosen");c.removeClass("active")},chosenCheck:function(a){var b=$(a.target),d=b.attr("data-size");d&&(d=Number(d),isNaN(d)&&(d=this.opt.select[0]),this.opt.pageSize!==d&&(this.opt.pageSize=d,this.opt.currentPage=1,c.updateSpin.apply(this),c.render.apply(this,[!0]),c.hideSelect.apply(this)))},formatOptions:function(){this.opt.pageSize=isNaN(Number(this.opt.pageSize))?d.pageSize:Number(this.opt.pageSize),this.opt.currentPage=isNaN(Number(this.opt.currentPage))?d.currentPage:Number(this.opt.currentPage),this.opt.totalCount=isNaN(Number(this.opt.totalCount))?d.totalCount:Number(this.opt.totalCount),this.opt.pageRange=isNaN(Number(this.opt.pageRange))?d.pageRange:Number(this.opt.pageRange);var a=this;$.each(this.opt.select,function(b,c){isNaN(Number(c))?a.opt.select[b]=d.select[b]:a.opt.select[b]=Number(c)})}},$.fn.NextPage=function(b){var c=this.prop("id");return new a(c,b)},define("cabin/widgets/nextpage/nextpage",function(require,c,d){b=require("cabin/widgets/nextpage/nextpage.tpl"),d.exports=function(b,c){return new a(b,c)}})}();